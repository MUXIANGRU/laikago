<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xenomai: Big dual kernel lock</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Xenomai"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xenomai
   &#160;<span id="projectnumber">3.0.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__rtdm__sync__biglock.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">Big dual kernel lock<div class="ingroups"><a class="el" href="group__rtdm.html">RTDM</a> &raquo; <a class="el" href="group__rtdm__driver__interface.html">Driver programming interface</a> &raquo; <a class="el" href="group__rtdm__sync.html">Synchronisation Services</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Big dual kernel lock:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__rtdm__sync__biglock.png" border="0" alt="" usemap="#group____rtdm____sync____biglock"/>
<map name="group____rtdm____sync____biglock" id="group____rtdm____sync____biglock">
<area shape="rect" id="node2" href="group__rtdm__sync.html" title="Synchronisation Services" alt="" coords="5,5,176,32"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga86168837a3f34f33912264b1a50ae6b1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rtdm__sync__biglock.html#ga86168837a3f34f33912264b1a50ae6b1">cobalt_atomic_enter</a>(__context)</td></tr>
<tr class="memdesc:ga86168837a3f34f33912264b1a50ae6b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enter atomic section (dual kernel only)  <a href="#ga86168837a3f34f33912264b1a50ae6b1">More...</a><br /></td></tr>
<tr class="separator:ga86168837a3f34f33912264b1a50ae6b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0828b83048e6bf62e2723f371af9d3b1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rtdm__sync__biglock.html#ga0828b83048e6bf62e2723f371af9d3b1">cobalt_atomic_leave</a>(__context)</td></tr>
<tr class="memdesc:ga0828b83048e6bf62e2723f371af9d3b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Leave atomic section (dual kernel only)  <a href="#ga0828b83048e6bf62e2723f371af9d3b1">More...</a><br /></td></tr>
<tr class="separator:ga0828b83048e6bf62e2723f371af9d3b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabbaf52632d5dde7fa66e0b70d887493b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rtdm__sync__biglock.html#gabbaf52632d5dde7fa66e0b70d887493b">RTDM_EXECUTE_ATOMICALLY</a>(code_block)</td></tr>
<tr class="memdesc:gabbaf52632d5dde7fa66e0b70d887493b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute code block atomically (DEPRECATED)  <a href="#gabbaf52632d5dde7fa66e0b70d887493b">More...</a><br /></td></tr>
<tr class="separator:gabbaf52632d5dde7fa66e0b70d887493b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga86168837a3f34f33912264b1a50ae6b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga86168837a3f34f33912264b1a50ae6b1">&#9670;&nbsp;</a></span>cobalt_atomic_enter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define cobalt_atomic_enter</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__context</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                    \</div><div class="line">                xnlock_get_irqsave(&amp;nklock, (__context));       \</div><div class="line">                xnsched_lock();                                 \</div><div class="line">        } <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
<p>Enter atomic section (dual kernel only) </p>
<p>This call opens a fully atomic section, serializing execution with respect to all interrupt handlers (including for real-time IRQs) and Xenomai threads running on all CPUs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">__context</td><td>name of local variable to store the context in. This variable updated by the real-time core will hold the information required to leave the atomic section properly.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Atomic sections may be nested. The caller is allowed to sleep on a blocking Xenomai service from primary mode within an atomic section delimited by cobalt_atomic_enter/cobalt_atomic_leave calls. On the contrary, sleeping on a regular Linux kernel service while holding such lock is NOT valid.</dd>
<dd>
Since the strongest lock is acquired by this service, it can be used to synchronize real-time and non-real-time contexts.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This service is not portable to the Mercury core, and should be restricted to Cobalt-specific use cases, mainly for the purpose of porting existing dual-kernel drivers which still depend on the obsolete <a class="el" href="group__rtdm__sync__biglock.html#gabbaf52632d5dde7fa66e0b70d887493b" title="Execute code block atomically (DEPRECATED) ">RTDM_EXECUTE_ATOMICALLY()</a> construct. </dd></dl>

</div>
</div>
<a id="ga0828b83048e6bf62e2723f371af9d3b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0828b83048e6bf62e2723f371af9d3b1">&#9670;&nbsp;</a></span>cobalt_atomic_leave</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define cobalt_atomic_leave</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__context</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                    \</div><div class="line">                xnsched_unlock();                               \</div><div class="line">                xnlock_put_irqrestore(&amp;nklock, (__context));    \</div><div class="line">        } <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
<p>Leave atomic section (dual kernel only) </p>
<p>This call closes an atomic section previously opened by a call to <a class="el" href="group__rtdm__sync__biglock.html#ga86168837a3f34f33912264b1a50ae6b1" title="Enter atomic section (dual kernel only) ">cobalt_atomic_enter()</a>, restoring the preemption and interrupt state which prevailed prior to entering the exited section.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">__context</td><td>name of local variable which stored the context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>This service is not portable to the Mercury core, and should be restricted to Cobalt-specific use cases. </dd></dl>

</div>
</div>
<a id="gabbaf52632d5dde7fa66e0b70d887493b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabbaf52632d5dde7fa66e0b70d887493b">&#9670;&nbsp;</a></span>RTDM_EXECUTE_ATOMICALLY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RTDM_EXECUTE_ATOMICALLY</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">code_block</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{                                               \</div><div class="line">        &lt;ENTER_ATOMIC_SECTION&gt;                  \</div><div class="line">        code_block;                             \</div><div class="line">        &lt;LEAVE_ATOMIC_SECTION&gt;                  \</div><div class="line">}</div></div><!-- fragment -->
<p>Execute code block atomically (DEPRECATED) </p>
<p>Generally, it is illegal to suspend the current task by calling <a class="el" href="group__rtdm__task.html#gabfae53746165a83a75965b7b0f6710a0" title="Sleep a specified amount of time. ">rtdm_task_sleep()</a>, <a class="el" href="group__rtdm__sync__event.html#ga1c433b50c53d49d164b084751861e855" title="Wait on event occurrence. ">rtdm_event_wait()</a>, etc. while holding a spinlock. In contrast, this macro allows to combine several operations including a potentially rescheduling call to an atomic code block with respect to other <a class="el" href="group__rtdm__sync__biglock.html#gabbaf52632d5dde7fa66e0b70d887493b" title="Execute code block atomically (DEPRECATED) ">RTDM_EXECUTE_ATOMICALLY()</a> blocks. The macro is a light-weight alternative for protecting code blocks via mutexes, and it can even be used to synchronise real-time and non-real-time contexts.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">code_block</td><td>Commands to be executed atomically</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>It is not allowed to leave the code block explicitly by using <code>break</code>, <code>return</code>, <code>goto</code>, etc. This would leave the global lock held during the code block execution in an inconsistent state. Moreover, do not embed complex operations into the code bock. Consider that they will be executed under preemption lock with interrupts switched-off. Also note that invocation of rescheduling calls may break the atomicity until the task gains the CPU again.</dd></dl>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">unrestricted</a></dd></dl>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000001">Deprecated:</a></b></dt><dd>This construct will be phased out in Xenomai 3.0. Please use rtdm_waitqueue services instead.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__rtdm__sync__biglock.html#ga86168837a3f34f33912264b1a50ae6b1" title="Enter atomic section (dual kernel only) ">cobalt_atomic_enter()</a>. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
